
<!doctype html>
<html>
  <head>
    <title>Social Squares</title>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
  </head>
  <body>
    <div id = "test"></div>
    <style>
      .socSquare{
        width:30px;
        height:30px;
        position:absolute;
        background-color: red;
      }
    </style>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var squareClients = []; //Array to hold all the clients
      var server = io(); //Server io

      var socialSquare = {//Base object for the squares
        id    : 0
      }

      var localSquareID = "#";

      function getRandomColor(){
        //Generates a random 6 digit number to be used as a color
        var num = Math.floor(Math.random() * (999999-111111)) + 111111;
        return "#" + num;
      }
      function createSocialSquare(id){
        //Creates a new element for the client
        var appendString = "<div id = " + id + " class = socSquare></div>";
        $("body").append(appendString)
        $("#" + id).css("left", id*50);
        //Generates a random color for the square
        var color = getRandomColor();
        $("#" + id).css("background-color", color);
        //Create the social square object to store
        newSquare = Object.create(socialSquare);
        newSquare.id = id;
        //Push the newly created square into the array
        squareClients.push(newSquare);
      }

      //Creates a new square whenever a user joins
      server.on('userAdded', function(elems){
          createSocialSquare(Number(elems));
      });

      server.on('userCreated', function(elems){

        //Create any squares that are already on the server
        for(var i = 1; i <= elems; i++){
          createSocialSquare(Number(i));
        }
        //create the players socialSquare
        createSocialSquare(elems + 1);
        localSquareID += (Number(elems) + 1);
      });

      var mousePos = [];
      $(document).mousemove(function(event){
        //Stores new mouse position in an array
        mousePos[0] = event.pageY-15;
        mousePos[1] = event.pageX-15;
        //Move the locally stored client based on mouse movement
        $(localSquareID).css("top", mousePos[0]);
        $(localSquareID).css("left", mousePos[1]);
        //Send the server the mouse position
        server.emit('mouseMove', mousePos);
      });

      //Listens to the server, waiting for a client to move its mouse
      server.on('clientMoved', function(clientInfo){
        //Generates the element ID to manipulate
        var cssID = "#" + Number(clientInfo[2]);
        //Moves the other squares, based on passed information
        $(cssID).css("top", clientInfo[0]);
        $(cssID).css("left", clientInfo[1]);
      });

      //Listens to the server, waiting for a client to leave
      server.on('clientLeft', function(id){
        //Generates the element ID to delete, then deletes it
        var delID = "#" + (Number(id) + 1);
        $(delID).remove();

        //Remove square from array, and shift elements overs
        squareClients.splice(id, 1);
        for(var i = id; i < squareClients.length; i++){
          squareClients[i].id -= 1;
        }
        //console.log(squareClients);
      });
    </script>
  </body>
</html>            