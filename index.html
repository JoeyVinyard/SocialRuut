
<!doctype html>
<html>
  <head>
    <title>Social Squares</title>
  </head>
  <body>
    <style>
      .socSquare{
        width:30px;
        height:30px;
        position:absolute;
        background-color: red;
      }
    </style>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var squareClients = [];
      var inOut = io();

      var socialSquare = {
        id    : 0
      }

      var localSquareID = "#";

      function getRandomColor(){
        var num = Math.floor(Math.random() * (999999-111111)) + 111111;
        return "#" + num;
      }
      function createSocialSquare(id){
        var appendString = "<div id = " + id + " class = socSquare></div>";
        $("body").append(appendString)
        $("#" + id).css("left", id*50);
        var color = getRandomColor();
        console.log(id);
        $("#" + id).css("background-color", color);
        newSquare = Object.create(socialSquare);
        newSquare.id = id;
        //Push it into the array
        squareClients.push(newSquare);
      }

      inOut.on('userAdded', function(elems){
          createSocialSquare(Number(elems));
      });

      inOut.on('userCreated', function(elems){
        console.log(elems);
        //create the socialSquare
        createSocialSquare(elems + 1);
        localSquareID += (Number(elems) + 1);
        for(var i = 1; i <= elems; i++){
          console.log("creating", i);
          createSocialSquare(Number(i));
        }
      });

      inOut.on('userDisconnected', function(){
        squareClients.pop();
      });

      var mousePos = [];
      $(document).mousemove(function(event){
        $(localSquareID).css("top", event.pageY-15);
        $(localSquareID).css("left", event.pageX-15);
        mousePos[0] = event.pageY-15;
        mousePos[1] = event.pageX-15;
        inOut.emit('mouseMove', mousePos);
      });

      inOut.on('mouseMoved', function(mousePosition){
        var cssID = "#" + Number(mousePosition[2]);
        $(cssID).css("top", mousePosition[0]);
        $(cssID).css("left", mousePosition[1]);
      });

      inOut.on('clientLeft', function(id){
        var delID = "#" + (Number(id) + 1);
        console.log("REMOVING USER " + delID);
        $(delID).remove();
        squareClients.splice(id, 1);
        console.log(squareClients.length, id);
        // for(var i = id; i <= squareClients.length; i++){
        //   squareClients[i].id--;
        //   cssID = "#" + (Number(i) + 1);
        //   console.log("CHANGING USER " + cssID + " to " + i);
        //   $(cssID).attr('id', i);
        // }
      });
    </script>
  </body>
</html>